## 微信小程序
  ​JS-SDK是对之前的 WeixinJSBrige 的一个包装，界面主要由Web技术渲染，通过暴露微信客户端原生能力的接口使开发者能够拥有更多的能力。
  用户进入小程序时，小程序代码包会被拉到本地

### 微信小程序的运行环境
| 运行环境  | 逻辑层 | 渲染层 |
| ------------- |:-------------:|:-------------:|
| iOS | JavaScriptCore | WKWebView |
| Android | X5 JSCore | X5浏览器 |
| 开发者工具 | NWJS | Chrome WebView |

#### 渲染层和逻辑层
小程序的运行环境分成渲染层和逻辑层，渲染层和逻辑层之间的线程通信经由微信APP做中转，逻辑层发送的网络请求也经由微信APP转发。
  JS 脚本工作在逻辑层，使用JsCore线程运行JS脚本，所有页面的脚本逻辑都跑在同一个JsCore线程中。
  WXML 模板和 WXSS 样式工作在渲染层，使用WebView线程进行渲染，每个页面各自有一个WebView线程进行渲染以提供更好的交互体验。
  **注意**：小程序切换页面时，小程序逻辑层的JS脚本运行上下文依旧在同一个JsCore线程中，页面逻辑中使用的定时器需要在页面离开时进行清理。
  **注意**：小程序宿主环境限制了页面栈的最大层级为10层，可以适当使用wx.reLaunch以重置页面栈。

#### 小程序的数据驱动
  在渲染层，宿主环境会把WXML转化成对应的JS对象，然后再渲染出真正的Dom树；
  在逻辑层发生数据变更时，通过宿主环境提供的setData方法把数据从逻辑层传递到渲染层，对比JS对象的前后差异，把差异应用在原来的Dom树上，渲染出正确的UI界面。

#### 脚本的执行顺序
  小程序的执行的入口文件是 app.js 。
  当app.js 执行结束后，小程序会按照app.json 中定义的 pages 的顺序，逐一执行。
  **注意**：页面路径需要在小程序的app.json的pages字段中声明，否则这个页面不会被注册到宿主环境中。
  **注意**：
    如果一个页面被多次创建，并不会使得这个页面所在的JS文件被执行多次，而仅仅是根据初始数据多生成了一个页面实例（this），在页面JS文件中直接定义的变量，在所有这个页面的实例间是共享的。
    例如，若从页面A使用wx.navigateTo跳转到页面B，再使用wx.navigateTo跳转到页面A，此时页面栈中有三个页面：A、B、A。这时两个A页面的实例将共享它的JS文件中Page构造器以外直接定义的变量。

#### 数据缓存
  本地数据缓存是小程序存储在当前设备上硬盘上的数据，每个小程序的缓存空间上限为10MB，以小程序及用户的纬度进行缓存数据隔离。
  **注意**：关闭、升级小程序并不影响缓存数据

#### 微信登录
  1.调用wx.login方法获取登录凭证
  2.服务端调用微信接口jscode2session获取信息
    session_key：会话密钥
    openid：用户在小程序/服务号/公众号的唯一标识
    unionid：用户在微信开放平台（服务号、公众号、小程序）的统一标识符。
  3.点击按钮调用wx.getUserInfo获取用户基础信息

#### 其他
  在公众平台设置基础库最低版本限制可避免功能无法使用而报错的情况。
  微信提供错误告警群来提醒报错信息，还可以通过Log.info上报消息。
  使用分包、大图上传oss以减少主包体积。
  主包与分包页共享app.js中全局变量：getApp({ allowDefault: true });
  在分包准备一个空白页面以供模版消息页面跳转的测试。
  小程序回跳参数在app.js的onShow方法中接收，部分机型会重复调用需要区分来源。
  可以通过getCurrentPages设置页面栈中的页面数据。
  使用web-view嵌入h5的地址最好加上随机数避免缓存、白屏的问题。
  在组件中使用observers观察properties属性变化以更新数据状态。
  组件设置styleIsolation: 'apply-shared'允许外部修改组件样式
  
 