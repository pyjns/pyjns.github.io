## 浏览器的响应步骤

### 1.DNS寻址
  **DNS（Domain Name System） 域名系统 ：**域名和IP地址相互映射的一个分布式数据库，目的是能更方便地访问互联网

### 2.TCP 握手
  **TCP (Transmission Control Protocol) 传输控制协议：** 获取到服务器IP地址后，浏览器会通过TCP”三次握手“与服务器建立连接，此机制目的是在两端传输数据之前，通过上层协议Https可以协商网络TCP套接字连接的一些参数。
  三次握手（SYN, SYN-ACK, ACK）建立连接，四次挥手断开连接。

### 3.TLS 协商
  **TLS（Transport Layer Security）传输层安全：**前身是安全套接层SSL(Secure Sockets Layer )，TLS协议要求服务器提供有效的数字证书来确认身份，以建立安全连接，防止第三方篡改及监听。
![img](https://media.prod.mdn.mozit.cloud/attachments/2019/06/17/16746/d7ca8e7376987926d47aadb940f4cace/ssl.jpg)

### 4.响应
  服务器连接建立后，浏览器就会代表用户发送一个初始的HTTP GET请求（对于网站来说这个请求通常是一个HTML文件）， 一旦服务器收到请求，它将使用相关的响应头及内容进行回复，浏览器在解析阶段遇到链接时才会去请求链接的资源
  **TTFB（Time to First Byte） ：** 请求与收到第一个字节响应信息的间隔时间，第一个报内容通常是14kb的数据。
  **TCP slow start / 14kb 规则） ：** TCP slow start是一种检测带宽、均衡网络传输速度、避免阻塞的算法，初始包14kb大小，后续的包依次是前一个包大小的二倍直到达到预定的阈值，或者遇到拥塞。  
![img](https://media.prod.mdn.mozit.cloud/attachments/2019/06/19/16754/bb30649c42ca0f017131411671e48a0e/congestioncontrol.jpg)

### 5.解析
  解析渲染是浏览器将接收的数据转换为DOM和CSSOM，并将CSSOM树和DOM树组合成一个Render树，用于计算每个可见元素的布局，并通过渲染器在屏幕上绘制成页面的步骤。

  #### 1).构建DOM
    DOM是浏览器标记的内部表示，包含页面所有的内容，DOM也是被暴露的，可以通过JavaScript中的各种API进行DOM操作，在渲染到屏幕上面之前，HTML、CSS、JavaScript必须被解析完成。
    DOM构造是增量的，当解析器发现非阻塞资源，例如<img>、CSS文件、有async或者defer属性的<script>，解析也可以继续进行，但是对于<script>标签会阻塞渲染并停止HTML的解析。

  #### 2).构建CSSOM
    CSSOM 包含了页面所有的样式，也就是如何展示 DOM 的信息。
    CSS是渲染阻塞，浏览器会阻塞页面渲染直到它接收和执行了所有的CSS，渲染阻塞是因为规则可以被覆盖，所以内容不能被渲染直到 CSSOM 的完成。

  #### 3).编译JavaScript
    JavaScript被解释、编译、解析为抽象语法树和执行。
    一些浏览器引擎使用”Abstract Syntax Tree“作为解释器，输出在主线程上执行的字节码。这就是所谓的JavaScript编译。

### 6.渲染
  渲染步骤包括样式、布局、绘制，在某些情况下还包括合成。

  #### 4).构建渲染树
    渲染树由DOM 和 CSSOM组合而成，渲染树只包含了可见内容。

  #### 5).布局
    布局是根据视区确定渲染树中所有节点的宽度、高度和位置，以及他们之间的相关性。
    以视区的大小为基础，用每个元素的框模型属性排列所有body的子孙元素的尺寸，为不知道其尺寸的替换元素（例如图像）提供占位符空间，一旦知道大小就会有回流。
    第一次确定节点的大小和位置称为布局，随后对节点大小和位置的重新计算称为回流，回流会触发重新绘制和重新组合。
    
  #### 6).绘制
    在绘制或光栅化阶段，浏览器把在布局阶段计算的所有盒子的可视部分转换为屏幕上的实际像素，包括文本、颜色、边框、阴影和替换的元素（如按钮和图像）。
    加载时整个屏幕被绘制出来，之后只有受影响的屏幕区域会被重绘，浏览器被优化为只重绘需要绘制的最小区域。

  #### 7).合成
    当文档的各个部分以不同的层绘制相互重叠时，需要进行合成以确保它们以正确的顺序绘制到屏幕上。	
    如果我们定义了图像的大小就不需要回流，只需要绘制需要的层，需要时会进行合成，如果没有包括图像大小而从服务器获取图片后，渲染过程将返回到布局步骤并从那里重新开始。

**优化 CRP(Critical Rendering Path) 关键渲染路径**
  提升页面加载速度需要通过被加载资源的优先级、控制它们加载的顺序和减小这些资源的体积。
  性能提示包含
    1）通过异步重要资源的下载来减小请求数量，
    2）优化必须的请求数量和每个请求的文件体积，
    3）通过区分关键资源的优先级来优化被加载关键资源的顺序，来缩短关键路径长度。

**交互**
  ”Time to Interactive“（TTI）是测量从第一个请求导致DNS查找和SSL连接到页面可交互时所用的时间——可交互是”First Contentful Paint“之后的时间点，响应时间最好小于50ms。